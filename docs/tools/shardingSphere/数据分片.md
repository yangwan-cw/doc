# ğŸ—‚ï¸ æ•°æ®åˆ†ç‰‡æ¦‚å¿µ

<!-- TOC -->

- [ğŸ—‚ï¸ æ•°æ®åˆ†ç‰‡æ¦‚å¿µ](#-%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87%E6%A6%82%E5%BF%B5)
    - [ä»€ä¹ˆæ˜¯æ•°æ®åˆ†ç‰‡](#%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87)
    - [åˆ†ç‰‡å¯¹è±¡](#%E5%88%86%E7%89%87%E5%AF%B9%E8%B1%A1)
    - [æ•°æ®æ‹†åˆ†æ–¹å¼](#%E6%95%B0%E6%8D%AE%E6%8B%86%E5%88%86%E6%96%B9%E5%BC%8F)
    - [å‚ç›´åˆ†ç‰‡](#%E5%9E%82%E7%9B%B4%E5%88%86%E7%89%87)
        - [å‚ç›´åˆ†åº“](#%E5%9E%82%E7%9B%B4%E5%88%86%E5%BA%93)
    - [å‚ç›´åˆ†è¡¨](#%E5%9E%82%E7%9B%B4%E5%88%86%E8%A1%A8)
        - [å‚ç›´åˆ†è¡¨](#%E5%9E%82%E7%9B%B4%E5%88%86%E8%A1%A8)
        - [æ°´å¹³åˆ†è¡¨](#%E6%B0%B4%E5%B9%B3%E5%88%86%E8%A1%A8)
        - [æ•°æ®åˆ†ç‰‡ç®—æ³•](#%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87%E7%AE%97%E6%B3%95)
    - [æ•´ä½“æµç¨‹](#%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B)

<!-- /TOC -->
- æ°´å¹³æ‹†åˆ†


## å‚ç›´åˆ†ç‰‡
### å‚ç›´åˆ†åº“
æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†çš„æ–¹å¼å«åšå‚ç›´æ‹†åˆ†ï¼Œç”¨å«åšçºµå‘æ‹†åˆ†ã€‚åœ¨æ‹†åˆ†ä¹‹å‰ï¼Œå¯¹æ•°æ®è¡¨è¿›è¡Œä¸šåŠ¡åˆ’åˆ†ï¼ŒæŸä¸€ç±»çš„æ•°æ®è¡¨æ±‡æ€»åˆ°æŸä¸€ç±»æ•°æ®åº“ã€‚æœ€ç»ˆå°†æ•°æ®åº“éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨
```mermaid
graph TD
    subgraph æœåŠ¡å™¨A[æœåŠ¡å™¨A: 192.168.1.10]
        userdb[ç”¨æˆ·ä¸šåŠ¡æ•°æ®åº“]
        userdb --> user[ç”¨æˆ·è¡¨]
    end

    subgraph æœåŠ¡å™¨B[æœåŠ¡å™¨B: 192.168.1.11]
        orderdb[è®¢å•ä¸šåŠ¡æ•°æ®åº“]
        orderdb --> order[è®¢å•è¡¨]
    end

    subgraph æœåŠ¡å™¨C[æœåŠ¡å™¨C: 192.168.1.12]
        productdb[å•†å“ä¸šåŠ¡æ•°æ®åº“]
        productdb --> product[å•†å“è¡¨]
    end

    %% å‚ç›´æ‹†åˆ†ç¤ºä¾‹ï¼š
    %% - ç”¨æˆ·è¡¨åœ¨æœåŠ¡å™¨A (192.168.1.10)
    %% - è®¢å•è¡¨åœ¨æœåŠ¡å™¨B (192.168.1.11)
    %% - å•†å“è¡¨åœ¨æœåŠ¡å™¨C (192.168.1.12)
    
```
é‚£ä¹ˆæŸ¥è¯¢çš„æ—¶å€™ï¼Œé€šè¿‡åˆ†ç‰‡çš„ä¸­é—´ä»¶è·¯ç”±åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œè¿™æ ·è¾¾åˆ°äº†å‚ç›´æ‹†åˆ†çš„åº”ç”¨

```mermaid
graph TD
    Client[å®¢æˆ·ç«¯]
    Middleware[åˆ†ç‰‡ä¸­é—´ä»¶]
    Client --> Middleware

    Middleware -- user_id --> A[æœåŠ¡å™¨192.168.1.10]
    Middleware -- order_id --> B[æœåŠ¡å™¨192.168.1.11]
    Middleware -- product_id --> C[æœåŠ¡å™¨192.168.1.12]
```
> ä½†æ˜¯ä¸èƒ½è§£å†³å•è¡¨æ•°æ®é‡è¿‡å¤§çš„åœºæ™¯ï¼Œåªèƒ½è§£å†³å¦‚ä¸‹
>
> - **è®¿é—®å•åº“å‹åŠ›**
> - **å•åº“æ•°æ®é‡å‹åŠ›**



## å‚ç›´åˆ†è¡¨

### å‚ç›´åˆ†è¡¨
å‚ç›´åˆ†è¡¨é€‚åˆå°†è¡¨ä¸­æŸäº›ä¸å¸¸ç”¨çš„åˆ—ï¼Œæˆ–è€…å ç”¨äº†å¤§é‡ç©ºé—´çš„åˆ—æ‹†åˆ†å‡ºå»

å‡è®¾æˆ‘ä»¬æ˜¯ä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œç”¨æˆ·åœ¨æµè§ˆå•†å“åˆ—è¡¨æ—¶ï¼Œä¸»è¦åªéœ€è¦å±•ç¤ºå•†å“çš„åç§°ï¼ˆnameï¼‰ã€ä»·æ ¼ï¼ˆpriceï¼‰å’Œä¸»å›¾ï¼ˆmain_imageï¼‰ï¼Œè€Œå•†å“çš„è¯¦ç»†æè¿°ï¼ˆdescriptionï¼‰å’Œç”¨æˆ·è¯„è®ºï¼ˆcommentsï¼‰å­—æ®µå†…å®¹è¾ƒå¤šä¸”ä¸€èˆ¬åªåœ¨å•†å“è¯¦æƒ…é¡µæ‰ä¼šç”¨åˆ°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°† description å’Œ comments å­—æ®µå•ç‹¬æ‹†åˆ†åˆ°å¦ä¸€å¼ è¡¨ä¸­ã€‚è¿™æ ·åœ¨æŸ¥è¯¢å•†å“åˆ—è¡¨æ—¶ï¼Œåªéœ€è®¿é—®ä¸»è¡¨ï¼Œèƒ½æ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ã€‚

å‚ç›´åˆ†è¡¨å¸¦æ¥çš„å¤æ‚æ€§ä¸»è¦ä½“ç°åœ¨æ“ä½œæ¬¡æ•°çš„å¢åŠ ã€‚ä¾‹å¦‚ï¼ŒåŸæ¥åªéœ€ä¸€æ¬¡æŸ¥è¯¢å°±èƒ½è·å– nameã€priceã€main_imageã€descriptionã€commentsï¼Œç°åœ¨éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼šä¸€æ¬¡æŸ¥è¯¢ nameã€priceã€main_imageï¼Œå¦ä¸€æ¬¡æŸ¥è¯¢ descriptionã€commentsã€‚


### æ°´å¹³åˆ†è¡¨
å­—æ®µï¼Œä¾‹å¦‚idï¼Œæˆ–è€…å¤šä¸ªidï¼Œæ ¹æ®æŸç§è§„åˆ™åˆ†æ•£è‡³å¤šä¸ªæ•°æ®è¡¨ä¸­ã€‚æ¯ä¸ªåˆ†ç‰‡åŒ…å«ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå½“è¦æŸ¥è¯¢çš„æ—¶å€™ï¼Œæ ¹æ®æŸç§è§„åˆ™å†æ‰¾å›æ¥ã€‚


  


### æ•°æ®åˆ†ç‰‡ç®—æ³•



## æ•´ä½“æµç¨‹

```mermaid
%% æ•°æ®åˆ†ç‰‡ï¼ˆShardingï¼‰Mermaid ç¤ºä¾‹
graph TB
    subgraph åº”ç”¨ç¨‹åº
        App[åº”ç”¨æœåŠ¡]
    end

    subgraph åˆ†ç‰‡ä¸­é—´ä»¶
        Sharding[ShardingSphere-JDBC/Proxy]
        Sharding -->|åˆ†ç‰‡é”®: user_id| Algorithm[åˆ†ç‰‡ç®—æ³•: å–æ¨¡]
        Sharding -->|åˆ†ç‰‡è§„åˆ™| Rule[åˆ†åº“åˆ†è¡¨è§„åˆ™: 2åº“Ã—2è¡¨]
    end

    subgraph åˆ†åº“åˆ†è¡¨å­˜å‚¨å±‚
        subgraph DB0[æ•°æ®åº“å®ä¾‹0]
            T0_0[(t_order_0)]
            T0_1[(t_order_1)]
        end

        subgraph DB1[æ•°æ®åº“å®ä¾‹1]
            T1_0[(t_order_0)]
            T1_1[(t_order_1)]
        end
    end

    %% å†™å…¥è¯·æ±‚ç¤ºä¾‹
    App -->|"INSERT user_id=100"| Sharding
    Sharding -->|"è·¯ç”±åˆ° DB0.t_order_0\n(user_id=100 % 2=0 â†’ DB0\n100 % 2=0 â†’ t_order_0)"| T0_0

    %% æŸ¥è¯¢è¯·æ±‚ç¤ºä¾‹
    App -->|"SELECT user_id=101"| Sharding
    Sharding -->|"è·¯ç”±åˆ° DB1.t_order_1\n(user_id=101 % 2=1 â†’ DB1\n101 % 2=1 â†’ t_order_1)"| T1_1

    %% åˆ†ç‰‡è§„åˆ™è¯´æ˜
    note[åˆ†ç‰‡è§„åˆ™:
      - åˆ†ç‰‡é”®: user_id
      - åº“åˆ†ç‰‡ç®—æ³•: user_id % 2 â†’ 2ä¸ªåº“ï¼ˆDB0/DB1ï¼‰
      - è¡¨åˆ†ç‰‡ç®—æ³•: user_id % 2 â†’ æ¯åº“2è¡¨ï¼ˆt_order_0/t_order_1ï¼‰
    ]
```